I started this Pull Request a long time ago.

Then I worked on it some more.

But since then, `master` has evolved.
